<!DOCTYPE html>
<html lang="ro" class="theme-dark">
    <head>
        <meta name="description" content="RiffRoom - magazin online de chitare și accesorii muzicale">
        <meta name="keywords" content="chitare, accesorii muzicale, RiffRoom, instrumente muzicale, amplificatoare">
        
        <!-- Script pentru a preveni clipirea temei luminoase -->
        <script>
            // Injectare instant a temei intunecate si full-width pentru produs
            (function() {
                document.documentElement.classList.add('theme-dark');
                document.body.classList.add('theme-dark');
                localStorage.setItem('theme', 'dark');
            })();
        </script>
        
        <title>RiffRoom - Pagina Produs</title>
        <%- include("../fragmente/head") %>     
        <link href="/resurse/css/produs.css" type="text/css" rel="stylesheet" />
        <link href="/resurse/css/tema.css" type="text/css" rel="stylesheet" />
        <link href="/resurse/css/seturi.css" type="text/css" rel="stylesheet" />
    </head>
    <body class="theme-dark">
        <%- include("../fragmente/header") %>
        
        <main class="theme-dark">
            <section class="theme-dark">
                <h2>Detalii Produs</h2>
                <article id="art-produs" class="theme-dark">
                    <%
                    // BONUS 18: Verificam dacă produsul este nou
                    const intervalProdusNou = 30 * 24 * 60 * 60 * 1000; // 30 zile în milisecunde
                    const acum = new Date();
                    const dataAdaugare = new Date(locals.prod.data_adaugare);
                    const diferentaTimp = acum - dataAdaugare;
                    const esteNou = diferentaTimp <= intervalProdusNou;
                    %>
                    
                    <div class="produs-header">
                        <h3><span class="nume"><%- locals.prod.nume %></span></h3>
                        <div class="badges-container">
                            <span class="badge-categorie <%- locals.prod.categorie.replace(/\s+/g, '-').toLowerCase() %>">
                                <%- locals.prod.categorie %>
                            </span>
                            <!-- BONUS 18: Marcaj produs nou pe pagina produsului -->
                            <% if(esteNou) { %>
                                <span class="badge-nou">
                                    <i class="fas fa-star"></i> NOU
                                </span>
                            <% } %>
                        </div>
                    </div>
                    
                    <div class="produs-container">
                        <div class="produs-imagine">
                            <figure class="imag-produs">
                                <img src="/resurse/imagini/produse/<%- locals.prod.imagine %>" alt="[imagine <%- locals.prod.nume %>]" />
                            </figure>
                        </div>
                        
                        <div class="produs-detalii">
                            <div class="pret-container">
                                <p>Preț: <span class="pret"><%- locals.prod.pret %> RON</span></p>
                                <button class="btn-adauga-cos">
                                    <i class="fas fa-cart-plus"></i> Adaugă în coș
                                </button>
                            </div>
                            
                            <div class="detalii-wrapper">
                                <p class="descriere-titlu">Descriere:</p>
                                <p class="descriere"><%- locals.prod.descriere %></p>
                                
                                <div class="detalii-tehnice">
                                    <h4>Specificații tehnice</h4>
                                    <table>
                                        <tr>
                                            <th>Tip produs:</th>
                                            <td><%- locals.prod.tip_produs %></td>
                                        </tr>
                                        <tr>
                                            <th>Greutate:</th>
                                            <td><%- locals.prod.greutate %> g</td>
                                        </tr>
                                        <% if(locals.prod.putere !== null) { %>
                                        <tr>
                                            <th>Putere:</th>
                                            <td><%- locals.prod.putere %> W</td>
                                        </tr>
                                        <% } %>
                                        <tr>
                                            <th>Categorie:</th>
                                            <td><%- locals.prod.categorie %></td>
                                        </tr>
                                        <tr>
                                            <th>Pentru începători:</th>
                                            <td>
                                                <% if(locals.prod.pentru_incepatori) { %>
                                                    <i class="fas fa-check text-success"></i> Da
                                                <% } else { %>
                                                    <i class="fas fa-times text-danger"></i> Nu
                                                <% } %>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Data adăugare:</th>
                                            <td>
                                                <time datetime="<%- locals.prod.data_adaugare %>">
                                                    <%= new Date(locals.prod.data_adaugare).toLocaleDateString('ro-RO', {
                                                        day: 'numeric',
                                                        month: 'long',
                                                        year: 'numeric',
                                                        weekday: 'long'
                                                    }) %>
                                                </time>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="caracteristici-container">
                                <h4>Caracteristici:</h4>
                                <% if(locals.prod.caracteristici && locals.prod.caracteristici.length) { %>
                                    <ul class="caracteristici-lista">
                                        <% locals.prod.caracteristici.forEach(function(caracteristica) { %>
                                            <li><i class="fas fa-check-circle"></i> <%= caracteristica %></li>
                                        <% }); %>
                                    </ul>
                                <% } else { %>
                                    <p>Nu sunt specificate caracteristici pentru acest produs.</p>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECTIUNE PENTRU AFISAREA SETURILOR ASOCIATE - Implementare simplificata -->
                    <% if(locals.seturi && locals.seturi.length > 0) { %>
                    <div class="associated-sets-simple">
                        <!-- Titlu sectiune pentru seturi asociate -->
                        <h3>Acest produs face parte din următoarele seturi:</h3>
                        
                        <!-- Container pentru cardurile de seturi -->
                        <div class="sets-grid">
                            <% for(let set of locals.seturi) { %>
                                <div class="set-box">
                                    <!-- Imaginea reprezentativa a setului (prima imagine din set) -->
                                    <div class="set-image">
                                        <img src="/resurse/imagini/produse/<%= set.produse[0].imagine %>" alt="<%= set.nume_set %>">
                                    </div>
                                    
                                    <!-- Detalii set -->
                                    <div class="set-info">
                                        <h4><%= set.nume_set %></h4>
                                        
                                        <!-- Pret set cu discount -->
                                        <div class="set-price">
                                            <p class="original-price"><%= set.pret_original %> RON</p>
                                            <p class="final-price"><%= set.pret_final %> RON <span class="discount-label">-<%= set.discount_procent %>%</span></p>
                                        </div>
                                        
                                        <!-- Buton pentru accesare set -->
                                        <a href="/set/<%= set.id %>" class="btn-view-set">
                                            <i class="fas fa-eye"></i> Vezi setul
                                        </a>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    <% } %>
                </article>
            </section>
        </main>

        <!-- NOUĂ SECȚIUNE: PRODUSE SIMILARE CU CARDURI - MEREU AFIȘATĂ -->
        <section class="produse-similare-carduri">
            <h3>Produse similare din categoria "<%- locals.prod.categorie %>"</h3>
            <p class="descriere-similare">Descoperiți și alte produse care v-ar putea interesa din aceeași categorie:</p>
            
            <div class="grid-produse-similare">
                <%
                // Filtrăm produsele similare din aceeași categorie, excluzând produsul curent
                // Această logică ar trebui să fie în controller, dar o punem aici pentru demonstrație
                let produseSimilareAfisate = [];
                
                // Simulăm obținerea produselor similare
                // În realitate, acestea ar trebui să vină din controller prin locals.produseSimilare
                if (locals.produseSimilare && locals.produseSimilare.length > 0) {
                    produseSimilareAfisate = locals.produseSimilare.slice(0, 4);
                } else if (locals.produse && locals.produse.length > 0) {
                    // Fallback: folosim produsele din aceeași categorie
                    produseSimilareAfisate = locals.produse
                        .filter(p => p.categorie === locals.prod.categorie && p.id !== locals.prod.id)
                        .slice(0, 4);
                }
                %>
                
                <% if (produseSimilareAfisate.length > 0) { %>
                    <% for(let prodSimilar of produseSimilareAfisate) { %>
                        <div class="card-produs-similar">
                            <%
                            // Verificăm dacă produsul similar este nou
                            const dataAdaugareSimilar = new Date(prodSimilar.data_adaugare);
                            const diferentaTimp = acum - dataAdaugareSimilar;
                            const esteNouSimilar = diferentaTimp <= intervalProdusNou;
                            %>
                            
                            <div class="imagine-similar">
                                <% if(esteNouSimilar) { %>
                                    <div class="badge-nou-similar">
                                        <i class="fas fa-star"></i> NOU
                                    </div>
                                <% } %>
                                <a href="/produs/<%= prodSimilar.id %>">
                                    <img src="/resurse/imagini/produse/<%= prodSimilar.imagine %>" alt="<%= prodSimilar.nume %>">
                                </a>
                            </div>
                            
                            <div class="info-similar">
                                <h4><a href="/produs/<%= prodSimilar.id %>"><%= prodSimilar.nume %></a></h4>
                                
                                <div class="detalii-rapide">
                                    <p class="pret-similar"><%= prodSimilar.pret %> RON</p>
                                    <p class="tip-similar"><%= prodSimilar.tip_produs %></p>
                                    <% if(prodSimilar.pentru_incepatori) { %>
                                        <span class="badge-incepatori">Pentru începători</span>
                                    <% } %>
                                </div>
                                
                                <% if(prodSimilar.caracteristici && prodSimilar.caracteristici.length > 0) { %>
                                    <div class="caracteristici-similare">
                                        <p class="label-caracteristici">Caracteristici principale:</p>
                                        <ul>
                                            <% for(let i = 0; i < Math.min(3, prodSimilar.caracteristici.length); i++) { %>
                                                <li><%= prodSimilar.caracteristici[i] %></li>
                                            <% } %>
                                            <% if(prodSimilar.caracteristici.length > 3) { %>
                                                <li class="mai-multe">și alte <%= prodSimilar.caracteristici.length - 3 %> caracteristici...</li>
                                            <% } %>
                                        </ul>
                                    </div>
                                <% } %>
                                
                                <div class="actiuni-produs">
                                    <a href="/produs/<%= prodSimilar.id %>" class="btn-vezi-detalii">
                                        <i class="fas fa-eye"></i> Vezi detalii
                                    </a>
                                    <button class="btn-compara-similar" 
                                            data-id="<%= prodSimilar.id %>" 
                                            data-nume="<%= prodSimilar.nume %>" 
                                            title="Adaugă la comparare">
                                        <i class="fas fa-balance-scale"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% } %>
                <% } else { %>
                    <!-- Mesaj dacă nu există produse similare -->
                    <div class="mesaj-no-similare">
                        <p>Nu există alte produse similare în această categorie momentan.</p>
                        <a href="/produse" class="btn-vezi-toate-produse">
                            <i class="fas fa-th-list"></i> Vezi toate produsele
                        </a>
                    </div>
                <% } %>
            </div>
            
            <% if (produseSimilareAfisate.length > 0) { %>
            <div class="link-toate-similare">
                <a href="/produse?categorie=<%- locals.prod.categorie %>" class="btn-vezi-toate-similare">
                    <i class="fas fa-th-list"></i> Vezi toate produsele din categoria "<%- locals.prod.categorie %>"
                </a>
            </div>
            <% } %>
        </section>

        <!-- Container pentru comparare - COMPLET ASCUNS INIȚIAL -->
        <div id="container-comparare" class="container-comparare" style="display: none;">
            <h3>Produse de comparat</h3>
            <ul id="lista-comparare" class="lista-comparare">
                <!-- Produsele selectate vor fi adăugate aici -->
            </ul>
            <button id="btn-afiseaza-comparatie" class="btn-afiseaza-comparatie" style="display: none;">
                <i class="fas fa-balance-scale"></i> Afișează comparația
            </button>
        </div>

        <%- include("../fragmente/footer") %>
        
        <!-- Includem scripturile noastre custom -->
        <script src="/resurse/js/produs.js"></script>
        <script src="/resurse/js/seturi.js"></script>
        <script src="/resurse/js/produse-comparare.js"></script>
        <script type="text/javascript" src=/resurse/js/produse-cos.js defer></script>
    </body>
</html>