<!DOCTYPE html>
<html lang="ro">
    <head>
        <meta name="keywords" content="magazin chitare, produse, oferte chitare, cautare chitara, chitare acustice, chitare electrice, accesorii chitara">
        <meta name="description" content="Magazin online de chitare si accesorii. Descopera o gama variata de produse pentru muzicieni de toate nivelurilor.">
        <link rel="stylesheet" href="/resurse/css/produse.css" type="text/css" />
        <!-- BONUS 11: CSS pentru modal box -->
        <link rel="stylesheet" href="/resurse/css/modal-produse.css" type="text/css" />
        <title>RiffRoom - Produse</title>
        <%- include("../fragmente/head") %>     
        <script type="text/javascript" src=/resurse/js/produse.js defer></script>
        <!-- BONUS 11: Script pentru modal box -->
        <script type="text/javascript" src=/resurse/js/modal-produse.js defer></script>
        <script type="text/javascript" src=/resurse/js/produse-cos.js defer></script>
    </head>
    <body>
        <%- include("../fragmente/header") %>
        
        <main>
            <!-- SECTIUNE PENTRU FILTRE -->
            <section id="filtrare-produse">
                <h2>Filtreaza produsele</h2>
                
                <div class="filtre-container">
                    <!-- INPUT TEXT PENTRU CAUTARE NUME -->
                    <div class="filtru-item">
                        <label for="inp-nume">
                            <i class="fas fa-search"></i> Cauta dupa nume:
                            <input type="text" id="inp-nume" placeholder="Ex: Gibson, Fender...">
                        </label>
                    </div>
                    
                    <!-- INPUT RANGE PENTRU PRET -->
                    <div class="filtru-item">
                        <label for="inp-pret"> 
                            <i class="fas fa-dollar-sign"></i> Pret minim: <span class="val-min">0</span>
                            <input type="range" id="inp-pret" value="0" min="0" max="15000"> 
                            <span class="val-max">15000</span>
                            <span id="infoRange">(0 RON)</span>
                        </label>
                    </div>
                    
                    <!-- RADIO BUTTONS PENTRU GREUTATE -->
                    <div class="filtru-item grup-radio">
                        <p><i class="fas fa-weight-hanging"></i> Greutate:</p>
                        <div class="radio-options">
                            <label>
                                <input id="i_rad1" name="gr_rad" value="0:2000" type="radio"/>
                                Usor (&lt; 2000g)
                            </label>
                            <label>
                                <input id="i_rad2" name="gr_rad" value="2000:4000" type="radio"/>
                                Mediu (2000-4000g)
                            </label>
                            <label>
                                <input id="i_rad3" name="gr_rad" value="4000:100000" type="radio"/>
                                Greu (&gt; 4000g)
                            </label>
                            <label>
                                <input id="i_rad4" checked name="gr_rad" value="toate" type="radio"/>
                                Toate
                            </label>
                        </div>
                    </div>
                    
                    <!-- TEXTAREA PENTRU CAUTARE IN DESCRIERE -->
                    <div class="filtru-item">
                        <label for="inp-descriere">
                            <i class="fas fa-align-left"></i> Cuvinte cheie in descriere:
                            <textarea id="inp-descriere" rows="2" placeholder="Ex: mahon, artar, premium..."></textarea>
                        </label>
                    </div>
                    
                    <!-- CHECKBOXURI PENTRU CARACTERISTICI -->
                    <div class="filtru-item grup-check">
                        <p><i class="fas fa-guitar"></i> Caracteristici:</p>
                        <div class="check-options">
                            <label>
                                <input type="checkbox" name="caracteristici" value="humbucker" checked> 
                                Humbucker
                            </label>
                            <label>
                                <input type="checkbox" name="caracteristici" value="single coil" checked> 
                                Single Coil
                            </label>
                            <label>
                                <input type="checkbox" name="caracteristici" value="mahon" checked> 
                                Mahon
                            </label>
                            <label>
                                <input type="checkbox" name="caracteristici" value="artar" checked> 
                                Artar
                            </label>
                            <label>
                                <input type="checkbox" name="caracteristici" value="rosewood" checked> 
                                Rosewood
                            </label>
                        </div>
                    </div>
                    
                    <!-- SELECT SIMPLU PENTRU CATEGORIE -->
                    <div class="filtru-item">
                        <label for="inp-categorie">
                            <i class="fas fa-tag"></i> Categorie:
                            <select id="inp-categorie">
                                <option id="sel-toate" selected value="toate">Toate categoriile</option>
                                <% for (let opt of locals.optiuni) { %>
                                    <option value="<%- opt.unnest %>"><%- opt.unnest %></option>
                                <% } %>
                            </select>
                        </label>
                    </div>
                    
                    <!-- SELECT MULTIPLU PENTRU TIP PRODUS -->
                    <div class="filtru-item">
                        <label for="inp-tip-produs">
                            <i class="fas fa-list"></i> Tip produs:
                            <select id="inp-tip-produs" multiple size="4">
                                <% for (let tip of locals.tipuri || [{ unnest: 'chitara electrica' }, { unnest: 'chitara acustica' }, { unnest: 'amplificator' }, { unnest: 'accesorii' }]) { %>
                                    <option value="<%- tip.unnest %>" selected><%- tip.unnest %></option>
                                <% } %>
                            </select>
                        </label>
                    </div>
                    
                    <!-- DATALIST PENTRU SUGESTII BRANDURI -->
                    <div class="filtru-item">
                        <label for="inp-brand">
                            <i class="fas fa-building"></i> Brand:
                            <input type="text" id="inp-brand" list="lista-branduri" placeholder="Alege un brand">
                            <datalist id="lista-branduri">
                                <option value="Gibson">Gibson</option>
                                <option value="Fender">Fender</option>
                                <option value="Ibanez">Ibanez</option>
                                <option value="Taylor">Taylor</option>
                                <option value="Martin">Martin</option>
                                <option value="PRS">PRS</option>
                                <option value="Epiphone">Epiphone</option>
                                <option value="Gretsch">Gretsch</option>
                                <option value="Marshall">Marshall</option>
                                <option value="Boss">Boss</option>
                                <option value="Orange">Orange</option>
                                <option value="Line 6">Line 6</option>
                                <option value="Dunlop">Dunlop</option>
                                <option value="Ernie Ball">Ernie Ball</option>
                            </datalist>
                        </label>
                    </div>
                    
                    <!-- BONUS 8: Sectiune pentru sortare multipla -->
                    <div class="filtru-item sortare-multipla">
                        <h4><i class="fas fa-sort"></i> Sortare după două chei</h4>
                        <div class="sortare-controls">
                            <div class="sortare-row">
                                <label for="select-cheie1">
                                    Prima cheie:
                                    <select id="select-cheie1">
                                        <option value="nume">Nume</option>
                                        <option value="pret" selected>Preț</option>
                                        <option value="categorie">Categorie</option>
                                        <option value="tip">Tip produs</option>
                                        <option value="data">Data adăugării</option>
                                    </select>
                                </label>
                            </div>
                            
                            <div class="sortare-row">
                                <label for="select-ordine">
                                    Ordine:
                                    <select id="select-ordine">
                                        <option value="crescator" selected>Crescător</option>
                                        <option value="descrescator">Descrescător</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BUTOANE PENTRU FILTRARE, SORTARE, CALCUL SI RESETARE -->
                    <div class="butoane-container">
                        <button id="filtrare" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Filtreaza
                        </button>
                        <button id="resetare" class="btn btn-danger">
                            <i class="fas fa-undo"></i> Reseteaza
                        </button>
                        <button id="sortCrescNume" class="btn btn-secondary">
                            <i class="fas fa-sort-amount-down-alt"></i> Sorteaza crescator
                        </button>
                        <button id="sortDescrescNume" class="btn btn-secondary">
                            <i class="fas fa-sort-amount-down"></i> Sorteaza descrescator
                        </button>
                        <!-- BONUS 8: Buton pentru sortare multipla -->
                        <button id="sortare-multipla" class="btn btn-info">
                            <i class="fas fa-sort-numeric-down"></i> Sortare multiplă
                        </button>
                        <button id="calculeaza-suma" class="btn btn-info">
                            <i class="fas fa-calculator"></i> Calculeaza suma
                        </button>
                        
                        <!-- BONUS 4: Indicator pentru filtrarea automatica -->
                        <div class="auto-filter-info">
                            <div class="auto-filter-badge" title="Filtrarea automată este activă">
                                <i class="fas fa-magic"></i> AUTO
                            </div>
                            <small style="color: #666; font-style: italic; margin-top: 0.5rem; display: block;">
                                Filtrarea se aplică automat la modificarea valorilor
                            </small>
                        </div>
                    </div>
                </div>
            </section>
            
            <p id="p-suma">Apasati Alt+"c" pentru suma preturilor produselor afisate.</p>
            
            <!-- SECTIUNE PENTRU AFISAREA PRODUSELOR -->
            <section id="produse">
                <h2>Produse disponibile</h2>
                
                <!-- BONUS 15: Container pentru contorul de produse -->
                <div id="contor-produse" class="contor-produse">
                    <div class="info-produse">
                        <i class="fas fa-list"></i>
                        <span class="numar-afisat">0</span> din 
                        <span class="numar-total">0</span> produse afișate
                    </div>
                </div>
                
                <div class="grid-produse">
                    <%
                    // BONUS 14: Calculam cele mai ieftine produse din fiecare categorie
                    const produsePeCategorie = {};
                    locals.produse.forEach(prod => {
                        if (!produsePeCategorie[prod.categorie]) {
                            produsePeCategorie[prod.categorie] = [];
                        }
                        produsePeCategorie[prod.categorie].push(prod);
                    });
                    
                    const celeMaiIeftine = {};
                    Object.keys(produsePeCategorie).forEach(categorie => {
                        const produseCat = produsePeCategorie[categorie];
                        const celMaiIeftin = produseCat.reduce((min, prod) => 
                            parseFloat(prod.pret) < parseFloat(min.pret) ? prod : min
                        );
                        celeMaiIeftine[celMaiIeftin.id] = categorie;
                    });
                    
                    // BONUS 18: Calculam produsele noi (adaugate in ultimele 30 de zile pentru demo)
                    const intervalProdusNou = 6 * 24 * 60 * 60 * 1000; // 30 zile in milisecunde
                    const acum = new Date();
                    %>
                    
                    <% for(let prod of locals.produse) { %>
                        <%
                        // Verificam daca produsul este nou
                        const dataAdaugare = new Date(prod.data_adaugare);
                        const diferentaTimp = acum - dataAdaugare;
                        const esteNou = diferentaTimp <= intervalProdusNou;
                        
                        // Verificam daca este cel mai ieftin din categoria sa
                        const esteCelMaiIeftin = celeMaiIeftine[prod.id];
                        %>
                        
                        <!-- BONUS 11: Click pe container deschide modal, click pe nume/imagine deschide pagina separata -->
                        <article class="produs <%= prod.categorie.replace(/\s+/g, '-').toLowerCase() %> <%= esteNou ? 'produs-nou' : '' %>" 
                                 id="ent<%= prod.id %>" data-product-id="<%= prod.id %>">
                            <!-- BONUS 18: Marcaj produs nou -->
                            <% if(esteNou) { %>
                                <div class="marcaj-nou">
                                    <i class="fas fa-star"></i> NOU
                                </div>
                            <% } %>
                            
                            <!-- BONUS 14: Marcaj cel mai ieftin -->
                            <% if(esteCelMaiIeftin) { %>
                                <div class="marcaj-ieftin">
                                    <i class="fas fa-trophy"></i> CEL MAI IEFTIN DIN CATEGORIA <%= esteCelMaiIeftin.toUpperCase() %>
                                </div>
                            <% } %>
                            
                            <!-- BONUS 11: Nume cu link separat pentru pagina produsului -->
                            <h3 class="nume">
                                <a href="/produs/<%= prod.id %>" class="product-link">
                                    <span class="val-nume"><%= prod.nume %></span>
                                </a>
                            </h3>
                            
                            <!-- TABEL CU CARACTERISTICILE PRODUSULUI -->
                            <div class="info-produs">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Pret</th>
                                            <th>Greutate</th>
                                            <th>Tip produs</th>
                                            <th>Data adaugarii</th>
                                            <th>Pentru Incepatori</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="val-pret"><%= prod.pret %></td>
                                            <td class="val-greutate"><%= prod.greutate %> g</td>
                                            <td class="val-tip"><%= prod.tip_produs %></td>
                                            <td>
                                                <time datetime="<%= prod.data_adaugare %>">
                                                    <%= new Date(prod.data_adaugare).toLocaleDateString('ro-RO', {
                                                        day: 'numeric',
                                                        month: 'long',
                                                        year: 'numeric',
                                                        weekday: 'long'
                                                    }) %>
                                                </time>
                                            </td>
                                            <td class="val-incepatori">
                                                <% if(prod.pentru_incepatori) { %>
                                                    <i class="fas fa-check text-success"></i>
                                                <% } else { %>
                                                    <i class="fas fa-times text-danger"></i>
                                                <% } %>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- DESCRIERE PRODUS -->
                            <p class="descriere">
                                <%= prod.descriere || 'Descriere indisponibila' %>
                            </p>
                            
                            <!-- BONUS 11: Imagine cu link separat pentru pagina produsului -->
                            <figure>
                                <a href="/produs/<%= prod.id %>" class="product-link">
                                    <img src="/resurse/imagini/produse/<%= prod.imagine %>" alt="[imagine <%= prod.nume %>]" />
                                </a>
                            </figure>
                            
                            <!-- CATEGORIE PRODUS -->
                            <p class="categorie">
                                Categorie: <span class="val-categorie badge"><%= prod.categorie %></span>
                            </p>
                            
                            <!-- CARACTERISTICI PRODUS -->
                            <div class="caracteristici">
                                <p>Caracteristici:</p>
                                <ul>
                                    <% if(prod.caracteristici && prod.caracteristici.length) { %>
                                        <% prod.caracteristici.forEach(function(caracteristica) { %>
                                            <li><%= caracteristica %></li>
                                        <% }); %>
                                    <% } else { %>
                                        <li>Nu sunt specificate</li>
                                    <% } %>
                                </ul>
                            </div>
                            
                            <!-- CHECKBOX SELECTARE PRODUS -->
                            <label class="selecteaza-cos">
                                <input type="checkbox" class="select-cos" value="<%= prod.id %>" autocomplete="off">
                                <span>Adauga in cos</span>
                            </label>
                        </article>
                    <% } %>
                </div>
            </section>
        </main>
        
        <%- include("../fragmente/footer") %>
        
        <!-- Script pentru initializarea bonusurilor -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // BONUS 15: Inițializează contorul cu valoarea corectă
            const totalProduse = document.querySelectorAll('.produs').length;
            const contorElement = document.getElementById('contor-produse');
            if (contorElement) {
                const numarTotal = contorElement.querySelector('.numar-total');
                const numarAfisat = contorElement.querySelector('.numar-afisat');
                if (numarTotal) numarTotal.textContent = totalProduse;
                if (numarAfisat) numarAfisat.textContent = totalProduse;
            }
            
        });
        </script>
    </body>
</html>
                                        <option value="categorie">Categorie</option>
                                        <option value="tip">Tip produs</option>
                                        <option value="data">Data adăugării</option>
                                    </select>
                                </label>
                                
                                <label for="select-cheie2">
                                    A doua cheie:
                                    <select id="select-cheie2">
                                        <option value="nume" selected>Nume</option>
                                        <option value="pret">Preț</option>
                                        <option value="greutate">Greutate</option>